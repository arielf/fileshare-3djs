<!DOCTYPE html>
<meta charset="utf-8">
<style>

/*
title { font: 40px sans-serif; font-weight: bold; }
.title { font: 40px sans-serif; font-weight: bold; }
.body { font: 40px sans-serif; font-weight: bold; }
body { font: 40px sans-serif; font-weight: bold; }
.text { font: 40px sans-serif; font-weight: bold; }
text { font: 40px sans-serif; font-weight: bold; }
body.svg.title { font: 40px sans-serif; font-weight: bold; }
*/

.node {
    stroke: #ffffff;
    stroke-width: 1.75px;
    stroke-opacity: 1.0;
}

.link {
    stroke: #999999;
    stroke-opacity: .7;
}

body {
    font-size: 48px;
    font-family: sans-serif;
    font-weight: bold;
}

/*
    div.tooltip {
        // position: absolute;
        text-align: center;
        width: 180px;
        height: 32px;
        padding: 2px;
        font: 48px sans-serif;
        background-color: black;
        color: white;
        border: 2px;
        border-radius: 8px;
        // pointer-events: none;
    }
    .ui-tooltip, .arrow:after {
        background-color: black;
        position: absolute;
        color: white;
        border: 2px solid white;
    }

    .ui-tooltip {
        width: 200px;
        height: 60px;
        padding: 10px 20px;
        position: relative;
        background: black;
        content: title;
        color: white;
        border-radius: 20px;
        font: bold 48px "Helvetica Neue", Sans-Serif;
        // text-transform: uppercase;
        box-shadow: 0 0 7px black;
    }
*/

/*

  .arrow {
    width: 90px;
    height: 16px;
    overflow: hidden;
    position: absolute;
    left: 50%;
    margin-left: -35px;
    bottom: -16px;
  }
  .arrow.top {
    top: -16px;
    bottom: auto;
  }
  .arrow.left {
    left: 20%;
  }
  .arrow:after {
    content: "";
    position: absolute;
    left: 20px;
    top: -20px;
    width: 25px;
    height: 25px;
    box-shadow: 6px 5px 9px -9px black;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
  }
  .arrow.top:after {
    bottom: -20px;
    top: auto;
  }
*/

</style>
<script type="text/javascript" src="d3.v3.min.js" charset="utf-8"></script>
<!-- script type="text/javascript" src="jquery-1.6.2.min.js" charset="utf-8"></script -->

<!-- script type="text/javascript" src="jquery-ui-1.11.4.js" charset="utf-8"></script -->

<body>
<script>
"use strict";
var Width = 1024, Height = 1024;
var LinkLen = Width/50;

var FS = "24px";

// Highlight users with a different group among file-sharers
// (These are marked as group == 3 in datobj.json)

// Links style
var LinkColor = "#999999";
var LinkWidth = 3;
var BadLinkColor = "#000000";
var BadLinkWidth = 12;

// Nodes style
var FileNodeSize = 9;
var UserNodeSize = 12;
var BadUserNodeSize = 20;
var FileNodeColor = "#33bbff";
var UserNodeColor = "#000000";
var BadUserNodeColor = "#ff0000";
var UndefUserNodeColor = "#ff00ff";

// define the div for the tooltips
var div = d3.select("body").append("div")
    .attr("class", "ui-tooltip")
        .style("color", "#ffffff")
        .style("background-color", "#000000")
        .style("text-align", "center")
        .style("font-size", FS)
        .style("font-weight", "bold")
;

var fixfont = function() {
    d3.select("ui-tooltip")
        .style("font-size", FS)
        .style("font-weight", "bold")
        .style("color", "#ffffff")
        .style("background-color", "#000000")
        .style("text-align", "center")
        .style("opacity", 1.0)
    ;
    div.html("")
        .style("left", (d3.event.pageX) + "px")
        .style("top", (d3.event.pageY - 28) + "px")
        .style("font-size", FS)
        .style("font-weight", "bold")
        .style("color", "#ffffff")
        .style("background-color", "#000000")
        .style("text-align", "center")
        .style("opacity", 1.0)
    ;
}
;

var bad_app = function(d) {
    return !(typeof d.app === 'undefined');
};

var app_width = function(d) {
    if (bad_app(d)) { return BadLinkWidth; };
    return LinkWidth;
};
var app_color = function(d) {
    if (bad_app(d)) { return BadLinkColor; };
    return LinkColor;
};

var force = d3.layout.force()
    .size([Width, Height])
    .charge(-45)
    .linkDistance(LinkLen)
    // .linkStrength(1.0)
    // .friction(0.9)
    // .chargeDistance(Width/2.0)
    .theta(0.7)
    // .gravity(0.1)
    ;

var svg = d3.select("body").append("svg")
    .attr("width", Width)
    .attr("height", Height)
    ;

d3.json("datobj.json", function(error, graph) {
    if (error) {
        alert(error);
        throw error;
    }

    force
        .nodes(graph.nodes)
        .links(graph.links)
        .start();

  var link = svg.selectAll(".link")
      .data(graph.links)
      .enter().append("line")
      .attr("class", "link")
      .style("fill", function(d) { return app_color(d) })
      .style("stroke-width", function(d) { return app_width(d) })
      ;

  var node = svg.selectAll(".node")
    .data(graph.nodes)
    .enter().append("circle")
    .attr("class", "node")
    .attr("r", function(d) {
            if (d.group == 1) return UserNodeSize;
            if (d.group == 2) return FileNodeSize;
            if (d.group == 3) return BadUserNodeSize;
            return BadUserNodeSize*2;
    })
    .style("fill", function(d) {
            if (d.group == 1) return UserNodeColor;
            if (d.group == 2) return FileNodeColor;
            if (d.group == 3) return BadUserNodeColor;
            return UndefUserNodeColor;
    })
    .on("mouseover", function(d) {
        // d3.timer.flush();
        div.transition()
            .delay(0)
            .duration(0)
            .style("opacity", 1.0)
        ;
        // fixfont();
    })
    .on("mouseout", function(d) {
        // d3.timer.flush();
        div.transition()
            .delay(0)
            .duration(0)
            .style("opacity", 0.0)
        ;
    })

    .call(force.drag)
    ;

    node.append("title")
        .text(function(d) {
            return d.name;
        })
        .style("font-weight", "bold")
        .style("font-size", FS)
        .style("color", "#ffffff")
    ;

    force.on("tick", function() {
        link.attr("x1", function(d) { return d.source.x; })
            .attr("y1", function(d) { return d.source.y; })
            .attr("x2", function(d) { return d.target.x; })
            .attr("y2", function(d) { return d.target.y; })
            ;

    node.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; })
        ;
    });
});

</script>
